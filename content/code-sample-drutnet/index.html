<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        
    

<title>Code sample for DrutNet API - connect, load node, save node and upload file</title>

        <meta name="description" content="">
        <meta name="keywords" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <!-- Favicon for all platforms -->
      <link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon-180x180.5691.png">
      <link rel="icon" type="image/png" href="/images/favicons/favicon-32x32.c391.png" sizes="32x32">
      <link rel="icon" type="image/png" href="/images/favicons/favicon-194x194.e5f8.png" sizes="194x194">
      <link rel="icon" type="image/png" href="/images/favicons/favicon-96x96.8557.png" sizes="96x96">
      <link rel="icon" type="image/png" href="/images/favicons/android-chrome-192x192.17e1.png" sizes="192x192">
      <link rel="icon" type="image/png" href="/images/favicons/favicon-16x16.7353.png" sizes="16x16">
      <link rel="manifest" href="/images/favicons/manifest.json">
      <meta name="msapplication-TileColor" content="#000000">
      <meta name="msapplication-TileImage" content="/images/favicons/mstile-144x144.png">
      <meta name="theme-color" content="#ffffff">
      <!-- End favicon for all platforms -->

      <link rel="stylesheet" href="/css/main.e76f.css"/>
      <link href='http://fonts.googleapis.com/css?family=Abril+Fatface&text=gizra' rel='stylesheet' type='text/css'>
      <link href='https://fonts.googleapis.com/css?family=Hind:400,600,300,500' rel='stylesheet' type='text/css'>
      <link href='https://fonts.googleapis.com/css?family=Raleway:400,300,600,800' rel='stylesheet' type='text/css'>
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
      <!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-6558346-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


      <!-- Begin Inspectlet Embed Code -->
      <script type="text/javascript" id="inspectletjs">
      window.__insp = window.__insp || [];
      __insp.push(['wid', 314054580]);
      (function() {
      function ldinsp(){if(typeof window.__inspld != "undefined") return; window.__inspld = 1; var insp = document.createElement('script'); insp.type = 'text/javascript'; insp.async = true; insp.id = "inspsync"; insp.src = ('https:' == document.location.protocol ? 'https' : 'http') + '://cdn.inspectlet.com/inspectlet.js'; var x = document.getElementsByTagName('script')[0]; x.parentNode.insertBefore(insp, x); };
      setTimeout(ldinsp, 500); document.readyState != "complete" ? (window.attachEvent ? window.attachEvent('onload', ldinsp) : window.addEventListener('load', ldinsp, false)) : ldinsp();
      })();
      </script>
      <!-- End Inspectlet Embed Code -->

    </head>
    <body>

    <!-- Main content -->
    
  



  
    
  

  
    
      
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  


<div id="post-page">
  <header id="header-post">
    <div class="container">
      <div class="row">
        <div class="col-sm-12">
          
  

<span class="gizra-logo"><a href="/">gizra</a></span>
<nav id="nav" role="navigation" class="navbar navbar-default">
  <div class="navbar-header">
    <button data-target=".navbar-collapse" data-toggle="collapse" class="navbar-toggle" type="button">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
  </div>
  <div class="navbar-collapse collapse">
    <ul class="nav navbar-nav">
      <li><a href="/#about" class="smooth-scroll-to">About Us</a></li>
      <li><a href="/services">Our Work</a></li>
      <li><a href="/team">Meet the Team</a></li>
      <li><a href="/blog">Blog</a></li>
      <li><a href="/contact">Contact</a></li>
    </ul>
  </div>
</nav>

        </div>
      </div>
    </div>
  </header>
  <article class="post">
    <div class="container">
      <div class="row">
        <div class="col-sm-10 col-sm-offset-1 post-title">
          <h1><a href="/content/code-sample-drutnet/">Code sample for DrutNet API - connect, load node, save node and upload file </a></h1>
          <div class="post-author">By Brice Lenfant</div>
        </div>
      </div>
      <div class="row">
        <div class="col-sm-2 col-sm-offset-1 post-data">
    			<div id="post-label">
    		 		<a href="/blog"><span class="label label-default">Gizra Blog</span></a>
    			</div>
          <div class="date">17 May 2010</div>
          <section class="author-details">
            <div class="image-wrapper">
              <img src="/images/team/avatars/bricel.8317.jpg" class="img-circle img-responsive">
            </div>
            <div class="text-wrapper">
              <span class="name">Brice Lenfant</span>
              
                <span class="twitter">(@briceAtGizra)</span>
              
              <div class="title">CEO, Co-Owner</div>
              <div class="bio">Brice leads strategy, and helps run projects at Gizra. He works closely with both the team and customers to strategize and develop the project end-to-end and coordinate project needs and delivery.</div>
            </div>
          </section>
          <div class="tags">
            <div class="title">Tags:</div>
            
              <ul class="inline">
                
                

  
    
      <li><a href="/tags.html#Drupal-planet-ref">Drupal-planet</a></li>
    
      <li><a href="/tags.html#.NET-ref">.NET</a></li>
    
      <li><a href="/tags.html#DrutNet-ref">DrutNet</a></li>
    
  


              </ul>
            
          </div>
        </div>
        <div class="col-sm-8">
          <div class="post-content">

              <p>In the previous <a href="/content/drutnet-drupal-net-api">post</a> I&rsquo;ve introduced DrutNet API with an already compiled example, today I will show some code examples.
Since last post I&rsquo;ve added a new method that allow file upload with Services, using the base-64 conversion, I will show you how this method works.</p>

<!-- more -->

<ol>
<li>Create a project in your preferred  .Net IDE, I use VS 2008 but those who prefer to work in the open source world can use the <a href= "http://www.mono-project.com" target="_blank">Mono IDE</a> instead.
</li><br></ul>
<li>To work with Services we need two assembly reference,  CookComputing.XmlRpcV2 and obviously Drutnet library (both dll are under  <a href="http://github.com/bricel/DrutNet/tree/master/Dlls/" target ="_blank">Dlls folder</a> stored in GitHub).
</li><br>
<li>Now we need to have a Drupal site with the <a href="http://drupal.org/project/Services" target= "_blank">Services module</a> installed  and the following modules enabled :
<ul>
<li>Services</li>
<li>XMLRPC Server </li>
<li>File Service</li>
<li>Node Service</li></ul>
</li>
<li>After adding the libraries and enabling the modules we can start working, first we need to create an instance of the ServicesSettings class and then of the Sevices class  :
&ldquo;`
 DrutNET.ServicesSettings services_settings= new DrutNET.ServicesSettings();
 services_settings.DrupalURL = @&quot;http://localhost/drupal-6.16/&rdquo;;
 services_settings.UseSessionID = false;
 services_settings.CleanURL = true;
&ldquo;`Here we define the connection settings, which include the path to your Drupal site, the type of security you have enabled in the services settings (only session ID is supported at this point) and clean URL settings.
&rdquo;`
DrutNET.Services service_connection = new DrutNET.Services(service_settings);
&ldquo;`Here we create an instance of the services class using the settings class instance created before.
</li><br>
<li>Now we can login to Drupal :
&rdquo;`
If (service_connection.Login(&ldquo;username&rdquo;, &ldquo;password&rdquo;))
  Console.Write(&ldquo;Login successfull&rdquo;);
else
  Console.Write(&ldquo;Login failed&rdquo;);
&ldquo;`* Make sure that the user has permission for all the services functions that you intend to use.
</li><br>
<li>Load and save a node :
&rdquo;`
int nideID = 1;
CookComputing.XmlRpc.XmlRpcStruct node = service_connection.NodeGet(nodeID);
node[&ldquo;body&rdquo;] = &ldquo;My new text&rdquo;;
service_connection.NodeSave(node);
&ldquo;`Here we use NodeGet method to load a node and then NodeSave method to save it back after making a change to the body field.
</li><br>
<li>Save a file to a node :
&rdquo;`
 string filePath = @&ldquo;c:\test.txt&rdquo;;
 int fileIndex = 0; // In case of multiple file field the index of the file.
 int nodeID = 1; // The node to attach the file to.
 string fieldName = &ldquo;field_file&rdquo; ; // CCK field name as defined in the content.
 service_connection.FileUpload(filePath , fileIndex , nodeID , fieldName);
&ldquo;`FileUpload method takes care of converting the file to base64 and also used both services FileSave and NodeSave.
</li></ol>


          </div>
        </div>
      </div>
    </div>
  </article>
    
  <section class="post-nav">
    <div class="container">
      <div class="row">
        <div class="col-xs-4 col-xs-offset-3 previous">
          
          <a href="/content/group-intro/">
            <div class="previous-label">
              <i class="fa fa-chevron-circle-left"></i>
              Previous<span class="visible-xs"> post</span><span class="hidden-xs">: Group (the new OG) intro</span>
            </div>
          </a>
          
        </div>
        <div class="col-xs-4 next">
          
          <a href="/content/message-module-and-ctools-plugin/">
            <div class="next-label">
              Next<span class="visible-xs"> post</span><span class="hidden-xs">: Message module and CTools $plugin</span>
              <i class="fa fa-chevron-circle-right"></i>
            </div>
          </a>
          
        </div>
      </div>
    </section>
    <section>
      <div class="container">
        <div class="row">
          <div class="col-sm-8 col-sm-offset-3">
            <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'gizra';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

          </div>
        </div>
      </div>
    </section>
  </div>
</div>


    <!--Footer -->
    
  <div id="contact">
    <footer id="footer">
      <div class="footer-wrapper">
        <div class="background">
          <div class="container">
            <div class="row">
              <div class="col-sm-12">
                <h2 class="title">Talk to us</h2>
                <div class="clearfix">
                  <address>
                    <div class="strong">Israel Headquarters</div>
                    <span>5 Brenner Street, Tel Aviv</span>
                      <a class="telephone" href="tel:+97233731222">+972-3-3731222</a>
                    <a class="email" href="mailto:info@gizra.com">info@gizra.com</a>
                  </address>
                  <address class="separator">
                    <div class="strong">North America Office</div>
                    <span>106 West 32nd Street, 2nd Floor, New York, NY 10008</span>
                    <a class="telephone" href="tel:+13476864508">347-686-4508</a>
                    <a class="email" href="mailto:usoffice@gizra.com">usoffice@gizra.com</a>
                  </address>
                  <div class="separator social-links">
                    <span class="link github">
                      <a href="https://github.com/Gizra" target="_blank" title="Gizra's Github Account"><i class="fa fa-github-square"></i></a>
                    </span>
                    <span class="link twitter">
                      <a href="https://twitter.com/gizra_drupal" target="_blank" title="Gizra's Twitter Account"><i class="fa fa-twitter-square"></i></a>
                    </span>
                    <span class="link linkedin">
                      <a href="https://www.linkedin.com/company/gizra-ltd" target="_blank" title="Gizra's LinkedIn Page"><i class="fa fa-linkedin-square"></i></a>
                    </span>
                    <span class="link facebook">
                      <a href="https://www.facebook.com/gizraltd/timeline" target="_blank" title="Gizra's Facebook Page"><i class="fa fa-facebook-square"></i></a>
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </footer>
  </div>



    <script src="/js/plugins.7686.js"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-backstretch/2.0.4/jquery.backstretch.min.js"></script>

    <script src="/js/scripts.1fc2.js"></script>
    </body>
</html>
